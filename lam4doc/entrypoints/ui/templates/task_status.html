{% extends "base.html" %}
{% import "macros.html" as macros %}
{% set active_page = "tasks" %}

{% block app_content %}
    <h1 id="title">{{ title }}</h1>
    
    <div class="row">
        <div class="col s12 z-depth-3 form">
            <div class="row">
                <div class="col s12">
                    <h4>Task Details</h4>
                    <table>
                        <tr>
                            <th>Task ID:</th>
                            <td>{{ task.id }}</td>
                        </tr>
                        <tr>
                            <th>Type:</th>
                            <td>{{ task.type }}</td>
                        </tr>
                        <tr>
                            <th>Status:</th>
                            <td>{{ task.status }}</td>
                        </tr>
                        <tr>
                            <th>Created:</th>
                            <td>{{ task.created_at }}</td>
                        </tr>
                        {% if task.completed_at %}
                        <tr>
                            <th>Completed:</th>
                            <td>{{ task.completed_at }}</td>
                        </tr>
                        {% endif %}
                        {% if task.error %}
                        <tr>
                            <th>Error:</th>
                            <td class="red-text">{{ task.error }}</td>
                        </tr>
                        {% endif %}
                        {% if task.result_id %}
                        <tr>
                            <th>Result:</th>
                            <td>
                                <a href="{{ url_for('download_report', report_id=task.result_id) }}" class="btn blue darken-2">
                                    Download Report <i class="material-icons right">file_download</i>
                                </a>
                            </td>
                        </tr>
                        {% endif %}
                    </table>
                </div>
            </div>
            
            <div class="row" style="margin-top: 2em;">
                <div class="col s12 right-align">
                    <a href="{{ url_for('tasks') }}" class="btn btn-file blue darken-2">
                        Back to Tasks <i class="material-icons right">arrow_back</i>
                    </a>
                    
                    {% if task.status == 'PENDING' or task.status == 'RUNNING' %}
                        <form method="POST" action="{{ url_for('stop_task', task_id=task.id) }}" style="display: inline-block;">
                            <button type="submit" class="btn red darken-2">
                                Stop Task <i class="material-icons right">stop</i>
                            </button>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    {% if task.status == 'PENDING' or task.status == 'RUNNING' %}
        <script>
            // Auto-refresh the page every 5 seconds if the task is still running
            setTimeout(function() {
                window.location.reload();
            }, 5000);
        </script>
    {% endif %}
{% endblock %}