{% extends "base.html" %}
{% import "macros.html" as macros %}
{% set active_page = "tasks" %}

{% block app_content %}
    <h1 id="title">{{ title }}</h1>
    
    <div class="row">
        <div class="col s12">
            <h4>Active Tasks</h4>
            {% if tasks %}
                <table class="striped responsive-table">
                    <thead>
                        <tr>
                            <th>Task ID</th>
                            <th>Type</th>
                            <th>Status</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for task in tasks %}
                            <tr>
                                <td><a href="{{ url_for('task_status', task_id=task.id) }}">{{ task.id }}</a></td>
                                <td>{{ task.type }}</td>
                                <td>{{ task.status }}</td>
                                <td>{{ task.created_at }}</td>
                                <td>
                                    {% if task.status == 'PENDING' or task.status == 'RUNNING' %}
                                        <form method="POST" action="{{ url_for('stop_task', task_id=task.id) }}">
                                            <button type="submit" class="btn-small red darken-2">
                                                Stop <i class="material-icons right">stop</i>
                                            </button>
                                        </form>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No active tasks.</p>
            {% endif %}
        </div>
    </div>
    
    <div class="row">
        <div class="col s12">
            <h4>Available Reports</h4>
            {% if reports %}
                <table class="striped responsive-table">
                    <thead>
                        <tr>
                            <th>Report ID</th>
                            <th>Type</th>
                            <th>Finished</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for report in reports %}
                            <tr>
                                <td>{{ report.uid }}</td>
                                <td>{{ report.type }}</td>
                                <td>{{ report.finished_at }}</td>
                                <td>
                                    <a href="{{ url_for('download_report', report_id=report.uid) }}" class="btn-small blue darken-2">
                                        Download <i class="material-icons right">file_download</i>
                                    </a>
                                    <form method="POST" action="{{ url_for('delete_report', report_id=report.uid) }}" style="display: inline-block;">
                                        <button type="submit" class="btn-small red darken-2">
                                            Delete <i class="material-icons right">delete</i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No reports available.</p>
            {% endif %}
        </div>
    </div>
{% endblock %}